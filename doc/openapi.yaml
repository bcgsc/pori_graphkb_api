
openapi: 3.0.0
info:
    title: Graph KB

tags:
    - name: Admin
      description: Administrative operations for adding, editing, and removing users
    - name: Diseases
      description: Operations to do with disease ontology terms
    - name: Anatomical Entities
      description: Operations to do with anatomical entity ontology terms

paths:
    /users:
        parameters:
            - $ref: '#/components/parameters/Authorization'
        get:
            summary: returns a list of users
            tags:
                - Admin
            parameters:
                - in: query
                  name: name
                  schema:
                    type: string
                  description: the user name
                - $ref: '#/components/parameters/returnProperties'
                  example: 'name,createdAt'
            responses:
                '200':
                    content:
                        application/json:
                            schema:
                                type: array
                                items:
                                    $ref: '#/components/schemas/User'
                    links:
                        userById:
                            $ref: '#/components/links/userById'
                '401':
                    $ref: '#/components/responses/NotAuthorized'
        post:
            summary: add a new user
            tags:
                - Admin
            requestBody:
                required: true
                content:
                    application/json:
                        schema:
                            $ref: '#/components/schemas/User'
            responses:
                '201':
                    content:
                        application/json:
                            schema:
                                $ref: '#/components/schemas/User'
                    links:
                        userById:
                            $ref: '#/components/links/userById'
                '401':
                    $ref: '#/components/responses/NotAuthorized'
                '409':
                    $ref: '#/components/responses/RecordExistsError'
    /users/{id}:
        parameters:
            - $ref: '#/components/parameters/@rid'
            - $ref: '#/components/parameters/Authorization'
        get:
            summary: return a particular user
            operationId: userById
            tags:
                - Admin
            responses:
                '200':
                    content:
                        application/json:
                            schema:
                                $ref: '#/components/schemas/User'
                '401':
                    $ref: '#/components/responses/NotAuthorized'
                '404':
                    $ref: '#/components/responses/RecordNotFound'
        patch:
            summary: alter an existing user record
            operationId: userById
            tags:
                - Admin
            requestBody:
                required: true
                content:
                    application/json:
                        schema:
                            $ref: '#/components/schemas/User'
            responses:
                '200':
                    content:
                        application/json:
                            schema:
                                $ref: '#/components/schemas/User'
                '401':
                    $ref: '#/components/responses/NotAuthorized'
                '404':
                    $ref: '#/components/responses/RecordNotFound'
        delete:
            summary: delete a user record
            operationId: userById
            tags:
                - Admin
            responses:
                '200':
                    content:
                        application/json:
                            schema:
                                $ref: '#/components/schemas/User'
                '401':
                    $ref: '#/components/responses/NotAuthorized'
                '404':
                    $ref: '#/components/responses/RecordNotFound'
    /diseases:
        parameters:
            - $ref: '#/components/parameters/Authorization'
        get:
            summary: returns a list of disease terms
            tags:
                - Diseases
            parameters:
                - $ref: '#/components/parameters/Ontology/name'
                - $ref: '#/components/parameters/Ontology/source'
                - $ref: '#/components/parameters/Ontology/sourceId'
                - $ref: '#/components/parameters/Ontology/sourceVersion'
                - $ref: '#/components/parameters/Ontology/longName'
                - $ref: '#/components/parameters/Ontology/nameVersion'
                - $ref: '#/components/parameters/limit'
                - $ref: '#/components/parameters/returnProperties'
                  example: 'name,source'
            responses:
                '200':
                    content:
                        application/json:
                            schema:
                                type: array
                                items:
                                    $ref: '#components/schemas/Disease'
                    links:
                        diseaseById:
                            $ref: '#/components/links/diseaseById'
                '401':
                    $ref: '#/components/responses/NotAuthorized'
        post:
            summary: add a new disease term record
            tags:
                - Diseases
            requestBody:
                required: true
                content:
                    application/json:
                        schema:
                            $ref: '#/components/schemas/Disease'
            responses:
                '201':
                    content:
                        application/json:
                            schema:
                                $ref: '#/components/schemas/Disease'
                    links:
                        diseaseById:
                            $ref: '#/components/links/diseaseById'
                '401':
                    $ref: '#/components/responses/NotAuthorized'
                '409':
                    $ref: '#/components/responses/RecordExistsError'
    /diseases/{id}:
        parameters:
            - $ref: '#/components/parameters/@rid'
            - $ref: '#/components/parameters/Authorization'
        get:
            summary: return a particular disease record
            operationId: diseaseById
            tags:
                - Diseases
            responses:
                '200':
                    content:
                        application/json:
                            schema:
                                $ref: '#/components/schemas/Disease'
                '401':
                    $ref: '#/components/responses/NotAuthorized'
                '404':
                    $ref: '#/components/responses/RecordNotFound'
        patch:
            summary: alter a particular disease record
            operationId: diseaseById
            tags:
                - Diseases
            responses:
                '200':
                    content:
                        application/json:
                            schema:
                                $ref: '#/components/schemas/Disease'
                '401':
                    $ref: '#/components/responses/NotAuthorized'
                '404':
                    $ref: '#/components/responses/RecordNotFound'
        delete:
            summary: delete a particular disease record
            operationId: diseaseById
            tags:
                - Diseases
            responses:
                '200':
                    content:
                        application/json:
                            schema:
                                $ref: '#/components/schemas/Disease'
                '401':
                    $ref: '#/components/responses/NotAuthorized'
                '404':
                    $ref: '#/components/responses/RecordNotFound'
    /anatomicalentities:
        parameters:
            - $ref: '#/components/parameters/Authorization'
        get:
            summary: returns a list of anatomical entity terms
            tags:
                - Anatomical Entities
            parameters:
                - $ref: '#/components/parameters/Ontology/name'
                - $ref: '#/components/parameters/Ontology/source'
                - $ref: '#/components/parameters/Ontology/sourceId'
                - $ref: '#/components/parameters/Ontology/sourceVersion'
                - $ref: '#/components/parameters/Ontology/longName'
                - $ref: '#/components/parameters/Ontology/nameVersion'
                - $ref: '#/components/parameters/returnProperties'
                  example: 'name,source'
            responses:
                '200':
                    content:
                        application/json:
                            schema:
                                type: array
                                items:
                                    $ref: '#components/schemas/AnatomicalEntity'
                    links:
                        anatomicalEntityById:
                            $ref: '#/components/links/anatomicalEntityById'
                '401':
                    $ref: '#/components/responses/NotAuthorized'
        post:
            summary: add a new anatomical entity record
            tags:
                - Anatomical Entities
            requestBody:
                required: true
                content:
                    application/json:
                        schema:
                            $ref: '#/components/schemas/AnatomicalEntity'
            responses:
                '201':
                    content:
                        application/json:
                            schema:
                                $ref: '#/components/schemas/AnatomicalEntity'
                    links:
                        anatomicalEntityById:
                            $ref: '#/components/links/anatomicalEntityById'
                '401':
                    $ref: '#/components/responses/NotAuthorized'
                '409':
                    $ref: '#/components/responses/RecordExistsError'
    /anatomicalentities/{id}:
        parameters:
            - $ref: '#/components/parameters/@rid'
            - $ref: '#/components/parameters/Authorization'
        get:
            summary: return a particular anatomical entity record
            operationId: anatomicalEntityById
            tags:
                - Anatomical Entities
            responses:
                '200':
                    content:
                        application/json:
                            schema:
                                $ref: '#/components/schemas/AnatomicalEntity'
                '401':
                    $ref: '#/components/responses/NotAuthorized'
                '404':
                    $ref: '#/components/responses/RecordNotFound'
        patch:
            summary: alter a particular anatomical entity record
            operationId: anatomicalEntityById
            tags:
                - Anatomical Entities
            responses:
                '200':
                    content:
                        application/json:
                            schema:
                                $ref: '#/components/schemas/AnatomicalEntity'
                '401':
                    $ref: '#/components/responses/NotAuthorized'
                '404':
                    $ref: '#/components/responses/RecordNotFound'
        delete:
            summary: delete a particular anatomical entity record
            operationId: anatomicalEntityById
            tags:
                - Anatomical Entities
            responses:
                '200':
                    content:
                        application/json:
                            schema:
                                $ref: '#/components/schemas/AnatomicalEntity'
                '401':
                    $ref: '#/components/responses/NotAuthorized'
                '404':
                    $ref: '#/components/responses/RecordNotFound'
    /therapies:
        parameters:
            - $ref: '#/components/parameters/Authorization'
        get:
            summary: returns a list of therapy terms
            tags:
                - Therapies
            parameters:
                - $ref: '#/components/parameters/Ontology/name'
                - $ref: '#/components/parameters/Ontology/source'
                - $ref: '#/components/parameters/Ontology/sourceId'
                - $ref: '#/components/parameters/Ontology/sourceVersion'
                - $ref: '#/components/parameters/Ontology/longName'
                - $ref: '#/components/parameters/Ontology/nameVersion'
                - $ref: '#/components/parameters/returnProperties'
                  example: 'name,source'
            responses:
                '200':
                    content:
                        application/json:
                            schema:
                                type: array
                                items:
                                    $ref: '#components/schemas/Therapy'
                    links:
                        getTherapyById:
                            parameters:
                                id: $response.body#/@rid
                            operationRef: '#/paths/~1therapies~1{id}/get'
                        editTherapyById:
                            parameters:
                                id: $response.body#/@rid
                            operationRef: '#/paths/~1therapies~1{id}/patch'
                            description: >
                                The `@rid` value returned in the response can be used as
                                the `id` parameter in PATCH `/users/{id}`.
                '401':
                    $ref: '#/components/responses/NotAuthorized'
        post:
            summary: add a new therapy record
            tags:
                - Therapies
            requestBody:
                required: true
                content:
                    application/json:
                        schema:
                            $ref: '#/components/schemas/Therapy'
            responses:
                '201':
                    content:
                        application/json:
                            schema:
                                $ref: '#/components/schemas/Therapy'
                    links:
                        getTherapyById:
                            parameters:
                                id: $response.body#/@rid
                            operationRef: '#/paths/~1therapies~1{id}/get'
                            description: >
                                The `@rid` value returned in the response can be used as
                                the `id` parameter in GET `/users/{id}`.
                        editTherapyById:
                            parameters:
                                id: $response.body#/@rid
                            operationRef: '#/paths/therapies/{id}/patch'
                            description: >
                                The `@rid` value returned in the response can be used as
                                the `id` parameter in PATCH `/users/{id}`.
                '401':
                    $ref: '#/components/responses/NotAuthorized'
                '409':
                    $ref: '#/components/responses/RecordExistsError'
    /therapies/{id}:
        parameters:
            - $ref: '#/components/parameters/@rid'
            - $ref: '#/components/parameters/Authorization'
        get:
            summary: return a particular therapy record
            operationId: therapyById
            tags:
                - Therapies
            responses:
                '200':
                    content:
                        application/json:
                            schema:
                                $ref: '#/components/schemas/Therapy'
                '401':
                    $ref: '#/components/responses/NotAuthorized'
                '404':
                    $ref: '#/components/responses/RecordNotFound'
        patch:
            summary: alter a particular therapy record
            operationId: therapyById
            tags:
                - Therapies
            responses:
                '200':
                    content:
                        application/json:
                            schema:
                                $ref: '#/components/schemas/Therapy'
                '401':
                    $ref: '#/components/responses/NotAuthorized'
                '404':
                    $ref: '#/components/responses/RecordNotFound'
        delete:
            summary: delete a particular therapy record
            operationId: therapyById
            tags:
                - Therapies
            responses:
                '200':
                    content:
                        application/json:
                            schema:
                                $ref: '#/components/schemas/Therapy'
                '401':
                    $ref: '#/components/responses/NotAuthorized'
                '404':
                    $ref: '#/components/responses/RecordNotFound'

components:
    links:
        userById:
            operationId: userById
            parameters:
                id: $response.body#/@rid
            description: 'The `@rid` value returned in the response can be used as the `id` parameter in `/users/{id}` operations.'
        diseaseById:
            operationId: diseaseById
            parameters:
                id: $response.body#/@rid
            description: 'The `@rid` value returned in the response can be used as the `id` parameter in `/diseases/{id}` operations.'
        anatomicalEntityById:
            operationId: anatomicalEntityById
            parameters:
                id: $response.body#/@rid
            description: 'The `@rid` value returned in the response can be used as the `id` parameter in `/anatomicalentities/{id}` operations.'
    responses:
        NotAuthorized:
            description: authorization failed or insufficient permissions were found
            content:
                application/json:
                    schema:
                        $ref: '#/components/schemas/Error'
        RecordNotFound:
            description: the record does not exist
            content:
                application/json:
                    schema:
                        $ref: '#/components/schemas/Error'
        RecordExistsError:
            description: the record already exists
            content:
                application/json:
                    schema:
                        $ref: '#/components/schemas/Error'
                        properties:
                            name:
                                example: 'RecordExistsError'
    parameters:
        returnProperties:
            in: query
            name: returnProperties
            schema:
                type: string
            description: csv list of attributes to return. Returns the whole record if not specified
        limit:
            in: query
            name: limit
            schema:
                type: integer
                nullable: true
            description: limits the number of records to return
            default: 1000
        Authorization:
            in: header
            name: Authorization
            schema:
                type: string
                format: token
            description: token containing the user information/authentication
        '@rid':
            in: path
            name: '@rid'
            schema:
                type: string
            description: record identifier
            example: '#34:1'
        createdAt:
            in: query
            name: createdAt
            schema:
                type: integer
            description: when the record was created
        createdBy:
            in: query
            name: createdBy
            description: the recordID of the user who created the record
            schema:
                type: string
        deletedAt:
            in: query
            name: deletedAt
            description: if given, indicates the time at which a record has been deleted. null for active records
            schema:
                type: integer
                nullable: true
        deletedBy:
            name: deletedBy
            in: query
            description: the recordID of the user who deleted the record
            schema:
                type: string
                nullable: true
        history:
            in: query
            name: history
            description: the recordID of the previous version of this record
            schema:
                type: string
                nullable: true
        uuid:
            name: uuid
            in: query
            description: record id that will be common for all versions of a given record
            schema:
                type: string
                format: uuid
        Ontology:
            description:
                name: description
                in: query
                schema:
                    type: string
                    nullable: true
                description: paragraph describing/defining the ontology term
            longName:
                name: longName
                in: query
                schema:
                    type: string
                    nullable: true
                description: extended name field for more verbose descriptor
            name:
                name: name
                in: query
                schema:
                    type: string
                description: the name of the ontology term
            nameVersion:
                name: nameVersion
                in: query
                schema:
                    type: string
                description: the version of the name (from the external source)
            source:
                in: query
                schema:
                    type: string
                description: the name of the external source the ontology term is derived from
            sourceId:
                name: sourceId
                in: query
                schema:
                    type: string
                    nullable: true
                description: the ID in the external source
            sourceVersion:
                name: sourceVersion
                in: query
                schema:
                    type: string
                    nullable: true
                description: the version of the external source
            subsets:
                in: query
                name: subsets
                schema:
                    type: string
                description: ontology subset this term belongs to
    schemas:
        Error:
            type: object
            properties:
                message:
                    type: string
                    description: the error message
                name:
                    type: string
                    description: the name of the type of error
                stacktrace:
                    type: string
                    description: optionally the error may include a stack trace to aid in debugging
        ODB:
            type:
                object
            properties:
                '@rid':
                    type: string
                    example: '#44:1'
                    pattern: '^#\d+:\d+$'
        UserGroup:
            allOf:
                - $ref: '#/components/schemas/ODB'
            type: object
            properties:
                name:
                    type: string
                    description: name of the user group
                permissions:
                    type: object
        User:
            allOf:
                - $ref: '#/components/schemas/ODB'
            type: object
            required:
                - name
            properties:
                name:
                    type: string
                createdAt:
                    description: when the record was created
                    type: integer
                deletedAt:
                    type: integer
                    nullable: true
                groups:
                    type: array
                    items:
                        $ref: '#/components/schemas/UserGroup'
                history:
                    oneOf:
                        - type: string
                          example: '#47:2'
                        - $ref: '#/components/schemas/User'
                    nullable: true
        Ontology:
            allOf:
                - $ref: '#/components/schemas/ODB'
            type: object
            required:
                - name
                - source
            properties:
                description:
                    type: string
                    nullable: true
                    description: paragraph describing/defining the ontology term
                longName:
                    type: string
                    description: extended name field for more verbose descriptor
                    nullable: true
                name:
                    type: string
                    description: the name of the ontology term
                nameVersion:
                    type: string
                    description: the version of the name (from the external source)
                source:
                    type: string
                    description: the name of the external source the ontology term is derived from
                sourceId:
                    type: string
                    nullable: true
                    description: the ID in the external source
                sourceVersion:
                    type: string
                    nullable: true
                    description: the version of the external source
                subsets:
                    type: array
                    description: ontology subset(s) this term belongs to
                    items:
                        type: string
        Disease:
            allOf:
                - $ref: '#/components/schemas/Ontology'
            type: object
            properties:
                name:
                    example: cancer
                source:
                    example: disease ontology
                sourceVersion:
                    example: "2018-03-02"
                sourceId:
                    example: "doid:162"
                description:
                    example: "a disease of cellular proliferation that is malignant and primary ..."
                subsets:
                    items:
                        example: "doid#DO_AGR_slim"
        AnatomicalEntity:
            allOf:
                - $ref: '#/components/schemas/Ontology'
            type: object
            properties:
                name:
                    example: peripheral nervous system
                source:
                    example: uberon
                sourceId:
                    example: "uberon:0000010"
                description:
                    example: "a major division of the nervous system that contains ..."
                subsets:
                    items:
                        example: "uberon/core#uberon_slim"
        Therapy:
            allOf:
                - $ref: '#/components/schemas/Ontology'
            type: object
            properties:
                name:
                    example: carboplatin





